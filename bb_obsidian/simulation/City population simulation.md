**TLDR:**
*Each casteâ€™s population is generated by first sampling age from an empirical or proxy demographic distribution, then sex from an age-dependent ratio, and finally income from an age- and caste-dependent lognormal distribution. Together, these layers form a synthetic microdata population consistent with macro-level constraints, which enables further modelling with a sample data.*

In this essay I'll go through in a rather great extent in the simulation of population, the research, the whys and the maths behind it. The society of [[City 1 ( name tdb)]]  is caste based, four casts make up most of the cities population, which is a little below 400 000 souls. The casts dominate the everyday life, they all have different demographics, destinies, work they can do and so on. Therefore, it was important for me to simulate them as precisely as one possibly can. More information on the caste system and the castes is **here** (todo: add link)

By city population simulation I mean to create a system (a python class in my case) which enables me to generate an age, sex, and income representative 10% sample from the population of [[City 1 ( name tdb)]]. 

### Age
Age plays a crucial role, the destiny of societies are based upon their demographics, how many children are born, what percentage of the population is able to work, how many elderly people relies on the workers. Since in the caste system all castes are rigorously separated, they follow different demographics. 

**The fourth caste** - miners and farmers - live in the poorest conditions among all. Their demographics are pyramid like, containing more young people, due to having less access to protection, and families relying more on their children. Elderly are seldom, due to mostly inaccessible health care. Thus, originally, my idea was to use the demographics of Brazilian favelas to base the fourth caste on, however, the unreliable data convinced me otherwise. The median age for favela folks is around 30, which is similar to El Salvador, therefore the latter country has been chosen as the baseline for my fourth caste population. El Salvador's population pyramid is accessible through this [webpage](https://www.census.gov/popclock/world/es). The demographic bins and probabilities were collected in numpy arrays, and then simply sampled a demographic bin and an age from it. 

```
sampled_bin = np.random.choice(len(probabilities), size=sample_size, p=probabilities)

sampled_age = np.random.uniform(age_bins[bin_indices], age_bins[bin_indices + 1])
```

**The third caste** - physical labour workers - operates with a median age of 36, slightly older than the fourth caste. For this exact caste, Uruguay's population pyramid has been chosen as guideline, a still young, yet mostly working age population. The method was very similar than for the fourth caste. 

**The second caste** - office workers - are really similar to the third cast in the [[City 1 ( name tdb)]]. Therefore, I could not differ much in terms of age either, so I used Australia's population pyramid as a guideline, with the median age of a little below 38. 

**The first caste** - old aristocrats - immediately remind me of the elderly West-European population, like Switzerland, France, the Netherlands for example. In the end I have decided to use Germany's population pyramid, which is rapidly aging, just as my tiny aristocrat caste, with the median age of 46.7. 

[Age distribution plots](age_pyramids.png)


### Income
Income is probably the second most important aspect in the society, especially if the main goal is to simulate economics, economical shocks. In our world, most societies have lognormal distributions, meaning that most people earn little while a very few people earn a lot more than everyone else. This is why calculating the average income is simply a statistical lie, because most people earn well below the statistical average. For the sake of simplicity, the inhabitants of the city use dollars and have income which is fairly similar to what people earn in the western societies. 

The income simulation is fairly similar to what I've used for age simulation. I sample certain distributions, which adds stochasticity while maintains a good approximation for how it would look like in the real world. Well, that's the point of taking a sample, after all, except that here I don't have a population, but replacing it with certain distributions makes it look like I do. 

$$ln X \sim \mathcal{N}(\mu, \sigma^2)$$

In order to sample from a lognormal distribution, the mean and variance should be calculated. For the sake of simplicity, I have used a single variance for all sampling ($\sigma = 1.0756001862584008$), however the mean is dynamic. On one hand, I have set a generic mean value for each cast ($\mu_1 = 10.6$, $\mu_2 = 9.7$, $\mu_3 = 9.5$, $\mu_4 = 9$) which is changing based on the persons age. In most societies the connection between age and income in negative quadratical, therefore I needed to come up with an equation to calculate a person-specific mean for the lognormal distribution:

$$\mu_ij = \mu_i + \beta_1 * (x_j - \overline x_i)/\sigma_xi - \beta_2 * ((x_j - \overline x_i)/\sigma_xi)^2$$

Where $\mu_i$ is the cast's pre-defined mean, $\mu_ij$ is the mean used for a specific age in that specific class, $x_j$ is the specific age itself and $\overline x_i$ is the average age for the cast. 

Education simulation is done with categorical numbers. 
Cast 1: level 1 or rarely 2
Cast 2 and 3: between level 2 and 5, 2-3-4 more probable
Cast 4: level 5, rarely 4

Lifestyle/health score